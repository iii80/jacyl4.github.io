<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.53" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Debian网关-旁路科学上网-Burst Link | 十四-Blog</title>
    <meta property="og:title" content="Debian网关-旁路科学上网-Burst Link - 十四-Blog">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2019-03-26T07:12:00&#43;08:00">
        
        
    <meta property="article:modified_time" content="2019-03-26T07:12:00&#43;08:00">
        
    <meta name="Keywords" content="[路由 debian gateway v2ray pihole doh]">
    <meta name="description" content="Debian网关-旁路科学上网-Burst Link">
        
    <meta name="author" content="JacyL4">
    <meta property="og:url" content="https://jacyl4.github.io/post/debian-gateway/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/css/normalize.css">
    
        <link rel="stylesheet" href="/css/prism.css">
    
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

    


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-135457802-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


    
    
        <link rel="stylesheet" href="/css/douban.css">
    
        <link rel="stylesheet" href="/css/other.css">
    
</head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://jacyl4.github.io/">
                        十四-Blog
                    </a>
                
                <p class="description">-</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://jacyl4.github.io/">首页</a>
                    
                    <a  href="https://jacyl4.github.io/archives/" title="存档">存档</a>
                    
                    <a  href="https://jacyl4.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">Debian网关-旁路科学上网-Burst Link</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2019年3月26日 -
                        </date>
                        
                        <div class="post-meta meta-category">
                            
                                <a href="https://jacyl4.github.io/categories/%E7%94%B5%E8%84%91">电脑</a>
                            
                        </div>
                        
                        
                        <div class="post-content">
                            

<p>继续书接上文，写在前面。</p>

<p>曾在ros+lede方案的文中，就提到浏览器体验速度，尽看DNS解析的快慢。线路不好，可以bbrplus/锐速来凑。</p>

<p>以前用LEDE作旁路，现直接跑在debian上当旁路了，纯粹是为了高效。</p>

<p>一键脚本分服务端跟客户端。
<img src="https://i.loli.net/2019/03/31/5ca0964035da6.png" alt="服务端" />
<img src="https://i.loli.net/2019/03/31/5ca0582b25cfb.png" alt="客户端" /></p>

<p>服务端，就是需要个vps。</p>

<p>客户端嘛，随便一个能跑debian的设备就行了，单网口就行。（支持 amd64 平台 以及 树莓派，香橙派 等 aarch64/arm64 平台）</p>

<p>结构上嘛，就是v2+ws+tls，dns去污染方面用dns-over-https，dns缓存用pihole并且客户端服务端皆有缓存。
（以往延用多年的chinadns去污染方案，需要国内国外dns都返回结果，才会作出判断，始终会有一定的延迟）</p>

<p>无疑是目前最速的通用扶墙方案，不过需要本地有个跑debian的设备。</p>

<p>流畅迅捷地加载页面元素，旨在实现最快速度地浏览页面。</p>

<h4 id="vps上通过网络重装办法安装最新debian">vps上通过网络重装办法安装最新debian</h4>

<p>ssh登录vps</p>

<pre><code>mkdir /boot/install
cd /boot/install
wget http://ftp.nl.debian.org/debian/dists/stretch/main/installer-amd64/current/images/netboot/debian-installer/amd64/initrd.gz
wget http://ftp.nl.debian.org/debian/dists/stretch/main/installer-amd64/current/images/netboot/debian-installer/amd64/linux
</code></pre>

<p>切换到vnc登录vps后，输入reboot重启，在grub界面按c进入命令行界面，手打输入：</p>

<pre><code>root=(hd0,1)
linux /boot/install/linux
initrd /boot/install/initrd.gz
boot
</code></pre>

<p>开始安装全新debian。</p>

<h4 id="新装的debian现在不允许直接以root登录-启用root登录">新装的debian现在不允许直接以root登录，启用root登录</h4>

<p>先以安装过程中创建的普通用户ssh登录vps，</p>

<pre><code>su
sed -i &quot;/PermitRootLogin/c\PermitRootLogin yes&quot;  /etc/ssh/sshd_config
systemctl restart sshd
</code></pre>

<p>现在就可以直接以root登录vps了。</p>

<h4 id="更换内核开启bbrplus">更换内核开启bbrplus：</h4>

<p>ssh登录vps</p>

<pre><code>apt-get update
apt-get -y upgrade
wget -N --no-check-certificate http://github.com/cx9208/Linux-NetSpeed/raw/master/bbrplus/debian-ubuntu/x64/linux-headers-4.14.91.deb
wget -N --no-check-certificate http://github.com/cx9208/Linux-NetSpeed/raw/master/bbrplus/debian-ubuntu/x64/linux-image-4.14.91.deb
dpkg -i linux-headers-4.14.91.deb
dpkg -i linux-image-4.14.91.deb
reboot
</code></pre>

<p>再次ssh登录vps</p>

<p>查看當前已經安裝的內核：</p>

<pre><code>dpkg -l|grep linux-image
</code></pre>

<p>刪除舊內核</p>

<pre><code>apt-get purge -y linux-image-4.9.0-8-amd64
update-grub
reboot
</code></pre>

<p>再次ssh登录vps</p>

<pre><code>sed -i '/net.core.default_qdisc/d' /etc/sysctl.conf
sed -i '/net.ipv4.tcp_congestion_control/d' /etc/sysctl.conf

echo &quot;net.core.default_qdisc=fq&quot; &gt;&gt; /etc/sysctl.conf
echo &quot;net.ipv4.tcp_congestion_control=bbrplus&quot; &gt;&gt; /etc/sysctl.conf

sysctl -p
</code></pre>

<p>到此bbrplus已生效。</p>

<h2 id="部署">部署</h2>

<h4 id="服务端">服务端：</h4>

<p>ssh登录vps</p>

<pre><code>apt-get install -y curl
curl -O https://raw.githubusercontent.com/jacyl4/de_GWD/master/de_GWD_Server/server &amp;&amp; chmod +x server &amp;&amp; ./server
</code></pre>

<p>选项2，套件安装过程中会弹出pihole安装对话框，服务端上不必要安装admin interface跟lighttpd。以方向键跟空格切换星号位置，其他一路回车。</p>

<p>不必要的两个选项截图如下
<img src="https://i.loli.net/2019/03/26/5c996ef762a0c.png" alt="Snipaste_2019-03-26_07-02-57" />
<img src="https://i.loli.net/2019/03/26/5c996ef782d96.png" alt="Snipaste_2019-03-26_07-03-18" /></p>

<p>线程就是vps有几个核。</p>

<p><a href="https://www.uuidgenerator.net/">UUID生成网站</a></p>

<p>“path”的话，可以选择uuid后几位 比如 /xxxxxx</p>

<p>安装完，重启一遍。就结束了。</p>

<p>选项3用于切换1.1.1.1的doh或者普通的8.8.8.8为上游dns。</p>

<p>选项4是因为安装过程中，会自动将vps改为静态ip，不再自动获取ip，万一的万一，以后需要换地址方便更改。</p>

<ul>
<li>补：脚本也支持 通过 <a href="https://lnmp.org/auto.html">lnmp.org</a> 安装的现有LNMP环境上 搭建，自适应的。</li>
<li>其他现有的LNMP环境很可能不支持</li>
</ul>

<p>LNMP环境下，证书位置在 /usr/local/nginx/conf/ssl</p>

<p>LNMP环境下，nginx 配置文件在 /usr/local/nginx/conf/vhost/域名.conf</p>

<p>所以最简洁的，还是全新debian上开始安装服务端。。。</p>

<h4 id="客户端">客户端：</h4>

<pre><code>wget --no-check-certificate https://raw.githubusercontent.com/jacyl4/de_GWD/master/de_GWD_Client/client -O ~/client &amp;&amp; chmod +x client &amp;&amp; ./client
</code></pre>

<p>UUID跟path 对应上面 服务端设置的。</p>

<p>pihole默认的google dns 受劫持影响很大，</p>

<p>为保证pihole快速顺利安装完，安装pihole时，dns 选最后一条 custom，并且指定为114
<img src="https://i.loli.net/2019/03/31/5c9fdcdf3f931.png" alt="Snipaste_2019-03-31_02-58-20" />
<img src="https://i.loli.net/2019/03/31/5c9fdce3a8191.png" alt="Snipaste_2019-03-31_02-39-59" /></p>

<p>选项3，可以用来重置pihole密码</p>

<p>选项9，DoH地址就填架过服务端的vps域名。只有一个的话，doh1 doh2填一样的。</p>

<p>。。。</p>

<p>装完后，去上级路由上，将dhcp分发的网关地址跟DNS地址 改成 此debian地址即可。</p>

<p>arm平台armbian暂时没有合适的镜像源，还是比较慢的。</p>

<p>暂时没有黑名单白名单功能。</p>

<p>默认运行在大陆白名单模式下。</p>

<p>以后修个简易web界面的时候，就把这功能做上。</p>

<p>下面的测试没什么参考价值，受电脑性能影响很大，只能是刷着玩的时候看下页面加载反应。</p>

<p><img src="https://i.loli.net/2019/03/26/5c9978c0e4345.png" alt="Snipaste_2019-03-26_08-56-07" />
<img src="https://i.loli.net/2019/03/26/5c9976e13b6c4.png" alt="Snipaste_2019-03-26_08-43-06" />
<img src="https://i.loli.net/2019/03/26/5c9976e51490d.png" alt="Snipaste_2019-03-26_08-41-49" />
<img src="https://i.loli.net/2019/03/26/5c9976e340cc8.png" alt="Snipaste_2019-03-26_08-45-49" />
<img src="https://i.loli.net/2019/03/26/5c9976e1f0872.png" alt="Snipaste_2019-03-26_08-45-23" />
<img src="https://i.loli.net/2019/03/26/5c9976e7c84ae.png" alt="Snipaste_2019-03-26_08-44-49" />
<img src="https://i.loli.net/2019/03/26/5c9976dfbdcbe.png" alt="Snipaste_2019-03-26_08-44-23" /></p>

<p>放个公益节点</p>

<pre><code>香港魔方云，4-28 后失效。50mbps 400G
可看netflix
acccc.ooo
4a3286e2-595e-49c6-9286-478531f43c49
/f43c49
</code></pre>

<p>完。</p>

<p>更细致的疑问，<a href="https://t.me/de_GWD">电报群</a>联系吧</p>

                        </div>

                        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/ros-openwrt-pihole-burstlink3/">【ROS&#43;OpenWrt&#43;Pi-hole合用】双线聚合，真旁路，超绝加速Burst Link【DNS补充篇】</a></li>
        
        <li><a href="/post/ros-openwrt-burstlink2/">【ROS&#43;OpenWrt合用】双线聚合，真旁路，超绝加速Burst Link【下篇】</a></li>
        
        <li><a href="/post/ros-openwrt-burstlink1/">【ROS&#43;OpenWrt合用】双线聚合，真旁路，超绝加速Burst Link【上篇】</a></li>
        
    </ul>
</div>


                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="https://jacyl4.github.io/tags/%E8%B7%AF%E7%94%B1">路由</a></li>
                                
                            </ul>
                            
                        </div>
                    </article>
                    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "jacyl4/jacyl4.github.io-comments"
            issue-term="title"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        <form id="search" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://jacyl4.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://jacyl4.github.io/post/debian-gateway/" title="Debian网关-旁路科学上网-Burst Link">Debian网关-旁路科学上网-Burst Link</a>
    </li>
    
    <li>
        <a href="https://jacyl4.github.io/post/hackintosh-z370n-wifi-cfg-lock/" title="黑苹果 技嘉z370n-wifi 主板 禁用 CFG LOCK 也就是 MSR 0xE2">黑苹果 技嘉z370n-wifi 主板 禁用 CFG LOCK 也就是 MSR 0xE2</a>
    </li>
    
    <li>
        <a href="https://jacyl4.github.io/post/ros-openwrt-pihole-burstlink3/" title="【ROS&#43;OpenWrt&#43;Pi-hole合用】双线聚合，真旁路，超绝加速Burst Link【DNS补充篇】">【ROS&#43;OpenWrt&#43;Pi-hole合用】双线聚合，真旁路，超绝加速Burst Link【DNS补充篇】</a>
    </li>
    
    <li>
        <a href="https://jacyl4.github.io/post/ros-openwrt-burstlink2/" title="【ROS&#43;OpenWrt合用】双线聚合，真旁路，超绝加速Burst Link【下篇】">【ROS&#43;OpenWrt合用】双线聚合，真旁路，超绝加速Burst Link【下篇】</a>
    </li>
    
    <li>
        <a href="https://jacyl4.github.io/post/ros-openwrt-burstlink1/" title="【ROS&#43;OpenWrt合用】双线聚合，真旁路，超绝加速Burst Link【上篇】">【ROS&#43;OpenWrt合用】双线聚合，真旁路，超绝加速Burst Link【上篇】</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://jacyl4.github.io/categories/%E7%94%B5%E8%84%91/">电脑(5)</a>
    </li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="https://jacyl4.github.io/tags/%E8%B7%AF%E7%94%B1/">路由</a>
    
    <a href="https://jacyl4.github.io/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C/">黑苹果</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://jacyl4.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
        &copy; 2018 <a href="https://jacyl4.github.io/">十四-Blog By JacyL4</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="http://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/rujews/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    <script type="text/javascript">
    
    (function(){
        $("pre code").parent().addClass("line-numbers")
    }())

    window.MathJax = {
        tex2jax: {
            inlineMath: [ ['$','$'] ],
            processEscapes: true
        }
    };
    </script>
    <script type="text/javascript" src="/js/prism.js" async="true"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src="/js/totop.js?v=0.0.0" async=""></script>





  <script src="/js/douban.js"></script>

</body>
</html>
